<div class="main">
  <div class="inputs">
    <input
      type="text"
      #scpiInput
      class="scpi-input"
      [(ngModel)]="inputText"
      autofocus
      (keydown.enter)="send()"
      (keydown.arrowUp)="arrowUp($event)"
      (keydown.arrowDown)="arrowDown($event)"
      placeholder="Type colon ':' to start. Enter to submit. Arrow up for history."
    />
    <button (click)="send()" [disabled]="sending$ | async">Send</button>
    <button (click)="systErr()" [disabled]="sending$ | async">:SYST:ERR?</button>
    @if (showSlowSendIndicator$ | async) {
      <div>...</div>
    }
  </div>

  <div class="log" [ngClass]="{ wrap: wrapLog() }">
    @for (entry of log(); track entry.time) {
      <div class="entry">
        {{ entry.time | date: 'medium' }}
        {{ entry.scpi }}
        {{ entry.response }}
        {{ entry.serverError }}
        <!-- TODO: fix track -->
        @for (error of entry.errors; track error) {
          {{ error }}
        }
      </div>
    }
  </div>
</div>

<div class="right-panel">
  @if (health.hasValue() && !health.value()) {
    <div>Health: Not OK!</div>
  }

  @if (idnFormatted()) {
    <div class="idn" [innerHtml]="idnFormatted()"></div>
  } @else if (idnError()) {
    IDN Error: {{ idnError()?.error }}
  }

  @if (error()) {
    Error: {{ error() }}
  }

  <div class="options">
    <label>
      <input type="checkbox" [(ngModel)]="simulated" />
      Simulated
    </label>
    <label>
      <input type="number" [(ngModel)]="timeoutSeconds" />
      Timeout (seconds)
    </label>
    <label>
      <input type="number" [(ngModel)]="port" (blur)="onPortBlur()" (keydown.enter)="onPortEnter($event)" />
      SCPI Socket Port
    </label>
    <label>
      <input type="checkbox" [(ngModel)]="autoSystErr" />
      Auto :SYST:ERR?
    </label>
    <label>
      <input type="checkbox" [(ngModel)]="wrapLog" />
      Wrap Log
    </label>
  </div>
</div>
